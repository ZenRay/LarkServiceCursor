# Lark Service 环境变量配置示例
# 复制此文件为 .env 并填入实际值

# ============================================
# PostgreSQL 配置 (Token 存储和用户缓存)
# ============================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=lark_service
POSTGRES_USER=lark
POSTGRES_PASSWORD=change_this_password_123

# ============================================
# RabbitMQ 配置 (消息队列)
# ============================================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=lark
RABBITMQ_PASSWORD=change_this_password_123

# ============================================
# 加密密钥配置
# ============================================

# 应用配置加密密钥 (SQLite 应用配置加密)
# 生成方式: openssl rand -base64 32
LARK_CONFIG_ENCRYPTION_KEY=CHANGE_THIS_TO_RANDOM_32_BYTE_KEY

# Token 数据加密密钥 (PostgreSQL Token 加密,可选)
# 如果启用,取消注释并生成随机密钥
# LARK_TOKEN_ENCRYPTION_KEY=CHANGE_THIS_TO_RANDOM_32_BYTE_KEY

# ============================================
# 日志配置
# ============================================
LOG_LEVEL=INFO

# ============================================
# 重要说明
# ============================================
#
# 1. 飞书应用凭证(App ID/Secret)不在此文件中配置
#    应用配置存储在 SQLite 数据库中,通过以下方式管理:
#
#    添加应用:
#    python -m lark_service.cli app add \
#      --app-id "cli_xxx" \
#      --app-secret "secret_xxx" \
#      --name "应用名称"
#
#    查看应用:
#    python -m lark_service.cli app list
#
# 2. 生产环境请务必:
#    - 修改所有默认密码为强密码
#    - 使用 openssl rand -base64 32 生成随机加密密钥
#    - 使用 Docker secrets 或 Kubernetes secrets 管理敏感信息
#    - 确保 .env 文件已添加到 .gitignore
#
# 3. 加密密钥说明:
#    - LARK_CONFIG_ENCRYPTION_KEY: 必需,用于加密 SQLite 中的 App Secret
#    - LARK_TOKEN_ENCRYPTION_KEY: 可选,用于加密 PostgreSQL 中的 Token

# ============================================
# WebSocket 配置
# ============================================

# WebSocket 最大重连次数 (默认: 10)
# WEBSOCKET_MAX_RECONNECT_RETRIES=10

# WebSocket 心跳间隔 (秒) (默认: 30)
# WEBSOCKET_HEARTBEAT_INTERVAL=30

# WebSocket 失败后降级到 HTTP 回调 (默认: true)
# WEBSOCKET_FALLBACK_TO_HTTP=true

# ============================================
# 用户授权配置
# ============================================

# 授权卡片包含详细描述 (默认: true)
# AUTH_CARD_INCLUDE_DESCRIPTION=true

# 授权卡片模板 ID (可选,使用自定义卡片模板)
# AUTH_CARD_TEMPLATE_ID=

# Token 刷新阈值 (0.0-1.0, 剩余生命周期比例) (默认: 0.8)
# 当 Token 剩余生命周期低于 80% 时自动刷新
# AUTH_TOKEN_REFRESH_THRESHOLD=0.8

# 授权会话过期时间 (秒) (默认: 600 = 10分钟)
# AUTH_SESSION_EXPIRY_SECONDS=600

# 授权请求频率限制 (每分钟) (默认: 5)
# AUTH_REQUEST_RATE_LIMIT=5

# ============================================
# 用户信息同步配置
# ============================================

# 启用用户信息定时同步 (默认: false)
# USER_INFO_SYNC_ENABLED=false

# 用户信息同步计划 (Cron 表达式) (默认: 每天凌晨2点)
# USER_INFO_SYNC_SCHEDULE=0 2 * * *

# ============================================
# 监控配置
# ============================================

# Prometheus 指标端口 (默认: 8000)
# PROMETHEUS_PORT=8000

# 启用 JSON 格式日志 (生产环境建议启用) (默认: false)
# LOG_JSON_FORMAT=false
