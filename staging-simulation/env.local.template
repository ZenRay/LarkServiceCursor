# ============================================================================
# Lark Service - 本地Staging模拟环境配置
# ============================================================================
#
# 使用方式:
# 1. 复制此文件: cp env.local.template .env.local
# 2. 根据需要修改配置值
# 3. 加载环境变量: export $(cat .env.local | grep -v '^#' | xargs)
#
# 注意: 这是本地Docker环境配置，仅用于测试
# 真实staging环境请使用 ../config/staging.env.template
#
# ============================================================================

# ----------------------------------------------------------------------------
# 1. 应用基础配置
# ----------------------------------------------------------------------------

ENVIRONMENT=staging-local
APP_NAME=lark-service
LOG_LEVEL=INFO
LOG_FORMAT=json
TZ=Asia/Shanghai

# ----------------------------------------------------------------------------
# 2. PostgreSQL 数据库配置
# ----------------------------------------------------------------------------

DB_HOST=localhost
DB_PORT=5433
DB_NAME=lark_service_staging
DB_USER=lark_staging
DB_PASSWORD=staging_password_local_only

# Alembic 迁移工具使用的环境变量 (与上面保持一致)
POSTGRES_HOST=localhost
POSTGRES_PORT=5433
POSTGRES_DB=lark_service_staging
POSTGRES_USER=lark_staging
POSTGRES_PASSWORD=staging_password_local_only

# 数据库连接池配置
DB_POOL_SIZE=5
DB_POOL_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# 数据库 SSL 配置 (本地环境不需要)
DB_SSL_MODE=disable

# ----------------------------------------------------------------------------
# 3. 飞书 API 配置
# ----------------------------------------------------------------------------

FEISHU_API_BASE_URL=https://open.feishu.cn

# 飞书应用凭证 (必填 - 需要从飞书开放平台获取)
# 获取方式: https://open.feishu.cn/app -> 创建应用 -> 凭证与基础信息
# 注意: 这些是示例值，实际使用时必须替换为真实凭证
LARK_APP_ID=cli_example_app_id_change_me
LARK_APP_SECRET=example_secret_32_chars_change_me

# Webhook和卡片配置 (可选)
FEISHU_WEBHOOK_VERIFICATION_TOKEN=your_verification_token_here
FEISHU_CARD_ENCRYPT_KEY=your_encrypt_key_here

# API调用配置
FEISHU_API_TIMEOUT=30
FEISHU_API_MAX_RETRIES=3
FEISHU_API_RETRY_BACKOFF_FACTOR=2

# ----------------------------------------------------------------------------
# 4. Token 管理配置
# ----------------------------------------------------------------------------

TOKEN_REFRESH_THRESHOLD=600

# Token 加密密钥 (本地测试用)
# 生成方式: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
TOKEN_ENCRYPTION_KEY=test_key_for_local_only_not_for_production_use

TOKEN_STORAGE_TYPE=postgres

# ----------------------------------------------------------------------------
# 5. RabbitMQ 配置 (可选)
# ----------------------------------------------------------------------------

RABBITMQ_HOST=localhost
RABBITMQ_PORT=5673
RABBITMQ_USER=lark_staging
RABBITMQ_PASSWORD=staging_rabbitmq_local_only
RABBITMQ_VHOST=/lark-staging

# ----------------------------------------------------------------------------
# 6. Redis 配置 (可选)
# ----------------------------------------------------------------------------

REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_PASSWORD=staging_redis_local_only
REDIS_DB=0

# ----------------------------------------------------------------------------
# 7. 监控配置
# ----------------------------------------------------------------------------

METRICS_PORT=9091
METRICS_ENABLED=true

# ----------------------------------------------------------------------------
# 8. 备份配置
# ----------------------------------------------------------------------------

BACKUP_DIR=/tmp/lark-service-backup
BACKUP_RETENTION_DAYS=7

# ============================================================================
# 本地环境说明:
#
# 1. 所有服务都运行在 localhost
# 2. 使用的是测试密码，不要用于生产环境
# 3. SSL/TLS 已禁用（本地环境）
# 4. 需要先启动 docker compose 服务:
#    cd staging-simulation && docker compose up -d
#
# 验证配置:
#   python scripts/validate_env.py staging-simulation/env.local.template
#
# 运行健康检查:
#   export $(cat staging-simulation/env.local.template | grep -v '^#' | xargs)
#   python scripts/staging_health_check.py
#
# ============================================================================
