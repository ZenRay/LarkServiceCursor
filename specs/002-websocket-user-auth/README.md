# WebSocket ç”¨æˆ·æˆæƒæ–¹æ¡ˆåˆ†ææ€»ç»“

**åˆ†ææ—¥æœŸ**: 2026-01-19
**åŠŸèƒ½åˆ†æ”¯**: `002-websocket-user-auth`
**çŠ¶æ€**: âœ… è§„èŒƒå·²å®Œæˆ

---

## ğŸ¯ æ ¸å¿ƒç»“è®º

**æœ€ä½³æ–¹æ¡ˆ**: WebSocket é•¿è¿æ¥å¡ç‰‡æˆæƒ â­â­â­â­â­

åŸºäº `example.py` ä»£ç ç¤ºä¾‹å’Œç°æœ‰æ–‡æ¡£åˆ†æ,WebSocket æ–¹æ¡ˆæ˜¯è·å– `user_access_token` çš„æœ€ä¼˜è§£ã€‚

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | WebSocket é•¿è¿æ¥ â­ | OAuth æ¶ˆæ¯é“¾æ¥ | HTTP å›è°ƒ |
| --- | --- | --- | --- |
| **éƒ¨ç½²å¤æ‚åº¦** | âœ…âœ… æç®€ (æ— éœ€ç«¯ç‚¹) | âŒ å¤æ‚ (éœ€ç«¯ç‚¹) | âŒ ä¸­ç­‰ (éœ€ç«¯ç‚¹) |
| **ç”¨æˆ·ä½“éªŒ** | âœ…âœ… æµç•… (é£ä¹¦å†…) | âš ï¸ ä¸€èˆ¬ (è·³è½¬) | âœ… æµç•… (é£ä¹¦å†…) |
| **å®æ—¶æ€§** | âœ…âœ… å®æ—¶æ¨é€ | âš ï¸ å¼‚æ­¥å›è°ƒ | âœ… å‡†å®æ—¶ |
| **å¯æ‰©å±•æ€§** | âœ…âœ… æ‰€æœ‰äº‹ä»¶ | âš ï¸ ä»…æˆæƒ | âœ… ä»…å¡ç‰‡ |
| **å¼€å‘å‘¨æœŸ** | 4.5-6.5 å¤© | 2-3 å¤© | 1-2 å¤© |

---

## â­ WebSocket æ–¹æ¡ˆæ ¸å¿ƒä¼˜åŠ¿

1. **éƒ¨ç½²æœ€ç®€å•** (æœ€å¤§äº®ç‚¹!)
   - âŒ æ— éœ€æš´éœ²å…¬ç½‘ HTTP ç«¯ç‚¹
   - âŒ æ— éœ€é…ç½®åŸŸåå’Œ HTTPS è¯ä¹¦
   - âœ… å†…ç½‘éƒ¨ç½²å³å¯ä½¿ç”¨

2. **ç”¨æˆ·ä½“éªŒæœ€ä½³**
   - âœ… å…¨ç¨‹åœ¨é£ä¹¦å†…å®Œæˆ
   - âœ… æˆæƒæ—¶é—´ä» 60s é™åˆ° 15s

3. **æŠ€æœ¯æˆç†Ÿå¯é **
   - âœ… lark-oapi SDK å·²å†…ç½® `lark.ws.Client`
   - âœ… é£ä¹¦å®˜æ–¹æ¨èæ–¹æ¡ˆ
   - âœ… `example.py` æä¾›å®Œæ•´å‚è€ƒ

4. **å¯æ‰©å±•æ€§å¼º**
   - âœ… å¯å¤ç”¨åˆ°ç¾¤æ¶ˆæ¯ã€å®¡æ‰¹ã€æ—¥ç¨‹ç­‰åœºæ™¯

---

## ğŸ” å…³é”®æŠ€æœ¯å‘ç°

### ä» example.py å­¦åˆ°çš„å®ç°æ¨¡å¼

**1. WebSocket å®¢æˆ·ç«¯åˆå§‹åŒ–**:
```python
# ä½¿ç”¨ SDK çš„ WebSocket å®¢æˆ·ç«¯
wsClient = lark.ws.Client(
    lark.APP_ID,
    lark.APP_SECRET,
    event_handler=event_handler,
    log_level=lark.LogLevel.DEBUG,
)
wsClient.start()
```

**2. äº‹ä»¶å¤„ç†å™¨æ³¨å†Œ**:
```python
# Builder æ¨¡å¼æ³¨å†Œäº‹ä»¶
event_handler = (
    lark.EventDispatcherHandler.builder("", "")
    .register_p2_card_action_trigger(handle_auth)
    .build()
)
```

**3. å¡ç‰‡å›è°ƒå¤„ç†**:
```python
def handle_auth(data: P2CardActionTrigger):
    open_id = data.event.operator.open_id
    # æ¢å– user_access_token
    # å­˜å‚¨åˆ°æ•°æ®åº“
    return P2CardActionTriggerResponse(content)
```

---

## ğŸ“‹ è§„èŒƒæ–‡æ¡£

å·²å®Œæˆçš„è§„èŒƒæ–‡æ¡£:

1. **åŠŸèƒ½è§„èŒƒ**: `specs/002-websocket-user-auth/spec.md`
   - 4 ä¸ªç”¨æˆ·æ•…äº‹ (P1-P2 ä¼˜å…ˆçº§)
   - 28 ä¸ªåŠŸèƒ½éœ€æ±‚
   - 13 ä¸ªæˆåŠŸæ ‡å‡†
   - è¾¹ç•Œæƒ…å†µè¦†ç›–

2. **è´¨é‡æ£€æŸ¥**: `specs/002-websocket-user-auth/checklists/requirements.md`
   - âœ… 17/17 æ£€æŸ¥é¡¹é€šè¿‡ (100%)
   - å†…å®¹è´¨é‡ã€éœ€æ±‚å®Œæ•´æ€§ã€åŠŸèƒ½å°±ç»ªåº¦å…¨éƒ¨é€šè¿‡

---

## ğŸ“… å®æ–½è®¡åˆ’

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ | çŠ¶æ€ |
| --- | --- | --- | --- |
| **Phase 0** | **åŠŸèƒ½è§„èŒƒ** | 0.5 å¤© | âœ… **å·²å®Œæˆ** |
| Phase 1 | æŠ€æœ¯è§„åˆ’ | 0.5 å¤© | â³ å¾…æ‰§è¡Œ |
| Phase 2 | P1 æ ¸å¿ƒå¼€å‘ | 4.5-6.5 å¤© | â¸ï¸ å¾…å¼€å§‹ |
| Phase 3 | P2 å¢å¼ºåŠŸèƒ½ | 2.5 å¤© | â¸ï¸ å¾…å¼€å§‹ |

**é¢„è®¡å‘å¸ƒ**: v0.2.0 (1.5-2 å‘¨å)

---

## ğŸ¯ ä¸‹ä¸€æ­¥

**æ¨è**: è¿›å…¥æŠ€æœ¯è§„åˆ’é˜¶æ®µ

```bash
/speckit.plan
```

**è§„åˆ’é‡ç‚¹**:
- WebSocket å®¢æˆ·ç«¯æ¶æ„è®¾è®¡
- æˆæƒæµç¨‹å®ç°ç»†èŠ‚
- aPaaS å®¢æˆ·ç«¯é›†æˆ
- æµ‹è¯•ç­–ç•¥å’Œç›‘æ§é…ç½®

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

**æ–°åˆ›å»º**:
- `specs/002-websocket-user-auth/spec.md`
- `specs/002-websocket-user-auth/checklists/requirements.md`

**ç°æœ‰å‚è€ƒ**:
- `example.py` - WebSocket ç¤ºä¾‹ä»£ç 
- [é£ä¹¦äº¤äº’å¼å¡ç‰‡æ–‡æ¡£](https://open.feishu.cn/document/develop-a-card-interactive-bot/explanation-of-example-code)
- [é£ä¹¦é•¿è¿æ¥æ–‡æ¡£](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/event-subscription-configure-/request-url-configuration-case#d286cc88)

---

**åˆ†æå®Œæˆ**: 2026-01-19
**ä¸‹ä¸€æ­¥**: `/speckit.plan`
