# é£ä¹¦aPaaS CRUD API è°ƒç ”æŠ¥å‘Š

**è°ƒç ”æ—¥æœŸ**: 2026-01-17
**ç›®æ ‡**: ç¡®è®¤aPaaS APIæ˜¯å¦æ”¯æŒCRUDæ“ä½œåŠSQLæ‰§è¡Œ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### âœ… å·²ç¡®è®¤å¯ç”¨çš„API

| æ“ä½œ | ç«¯ç‚¹ | æ–¹æ³• | çŠ¶æ€ |
|------|------|------|------|
| **æŸ¥è¯¢è®°å½•** | `/apaas/v1/workspaces/{workspace_id}/tables/{table_id}/records` | GET | âœ… **å®Œå…¨å¯ç”¨** |
| **åˆ é™¤è®°å½•** | `/apaas/v1/workspaces/{workspace_id}/tables/{table_id}/records` | DELETE | âš ï¸ **éƒ¨åˆ†å¯ç”¨** (éœ€éªŒè¯æ ¼å¼) |

### âŒ ä¸å¯ç”¨çš„API

| æ“ä½œ | æµ‹è¯•ç«¯ç‚¹ | çŠ¶æ€ |
|------|----------|------|
| åˆ›å»ºè®°å½• | POST `/records` | âŒ 400é”™è¯¯ (å‚æ•°æ ¼å¼é—®é¢˜) |
| æ›´æ–°è®°å½• | PUT `/records/{id}` | âŒ 404ä¸å­˜åœ¨ |
| æ‰¹é‡åˆ›å»º | POST `/records/batch_create` | âŒ 404ä¸å­˜åœ¨ |
| æ‰¹é‡æ›´æ–° | POST `/records/batch_update` | âŒ 404ä¸å­˜åœ¨ |
| æ‰¹é‡åˆ é™¤ | POST `/records/batch_delete` | âŒ 404ä¸å­˜åœ¨ |
| SQLæ‰§è¡Œ | POST `/sql/execute` | âŒ 404ä¸å­˜åœ¨ |

---

## ğŸ” è¯¦ç»†æµ‹è¯•ç»“æœ

### 1. æŸ¥è¯¢Records API âœ… **æˆåŠŸ**

**ç«¯ç‚¹**: `GET /apaas/v1/workspaces/{workspace_id}/tables/{table_id}/records`

**å‚æ•°**:
- `page_size`: åˆ†é¡µå¤§å°
- `page_token`: åˆ†é¡µä»¤ç‰Œ

**å“åº”æ ¼å¼**:
```json
{
  "code": 0,
  "data": {
    "total": 39,
    "has_more": true,
    "page_token": "xxx",
    "items": "[{...}]"  // æ³¨æ„: itemsæ˜¯JSONå­—ç¬¦ä¸²,éœ€è¦parse
  }
}
```

**è®°å½•ç»“æ„**:
```json
{
  "id": "7f8838f2-f51d-4012-82b1-7592bea87bab",
  "customer_id": "9f837291-5bb9-4200-b8c6-ae3909b5b7f0",
  "followup_date": "2025-11-16T00:00:00+08:00",
  "channel": "é‚®ä»¶",
  "content": "...",
  "owner_id": {
    "id": "1847220515459434",
    "name": "åœ¨å¦™æ­çš„Jingpu",
    "avatar": "https://..."
  },
  "stage": "æ½œåœ¨å®¢æˆ·",
  "_created_at": "2025-12-09T16:22:13.050834+08:00",
  "_created_by": { "id": "...", "name": "..." },
  "_updated_by": { "id": "...", "name": "..." }
}
```

**å…³é”®å‘ç°**:
- âœ… APIå®Œå…¨å·¥ä½œ
- âš ï¸ `items`å­—æ®µæ˜¯JSONå­—ç¬¦ä¸²,éœ€è¦äºŒæ¬¡è§£æ
- âœ… åŒ…å«ç³»ç»Ÿå­—æ®µ: `_created_at`, `_created_by`, `_updated_by`
- âœ… æ”¯æŒåˆ†é¡µ: `page_size`, `page_token`, `has_more`

---

### 2. åˆ›å»ºRecords API âŒ **å¤±è´¥**

**æµ‹è¯•ç«¯ç‚¹**: `POST /apaas/v1/workspaces/{workspace_id}/tables/{table_id}/records`

**æµ‹è¯•payload**:
```json
{
  "records": [{
    "customer_id": "test-001",
    "followup_date": "2026-01-17T10:00:00+08:00",
    "channel": "APIæµ‹è¯•",
    "content": "æµ‹è¯•è®°å½•"
  }]
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": 9499,
  "msg": "Invalid parameter type in json: Records. Invalid parameter value: [...]. Please check and modify accordingly."
}
```

**åˆ†æ**:
- âŒ POSTåˆ° `/records` ç«¯ç‚¹å­˜åœ¨ä½†å‚æ•°æ ¼å¼ä¸æ­£ç¡®
- âš ï¸ é”™è¯¯æç¤º "Records" å‚æ•°ç±»å‹æ— æ•ˆ
- å¯èƒ½åŸå› :
  1. å­—æ®µç±»å‹ä¸åŒ¹é… (å¦‚customer_idéœ€è¦UUIDè€Œéå­—ç¬¦ä¸²)
  2. ç¼ºå°‘å¿…éœ€å­—æ®µ
  3. APIæ–‡æ¡£æœªå…¬å¼€çš„ç‰¹æ®Šæ ¼å¼è¦æ±‚

---

### 3. æ›´æ–°Records API âŒ **ç«¯ç‚¹ä¸å­˜åœ¨**

**æµ‹è¯•ç«¯ç‚¹**:
- `PUT /records/{record_id}` â†’ 404
- `PATCH /records/{record_id}` â†’ 404
- `PUT /records` â†’ 404

**ç»“è®º**: æ²¡æœ‰å‘ç°å¯ç”¨çš„æ›´æ–°ç«¯ç‚¹

---

### 4. æ‰¹é‡æ“ä½œAPI âŒ **ç«¯ç‚¹ä¸å­˜åœ¨**

æµ‹è¯•çš„æ‰€æœ‰æ‰¹é‡ç«¯ç‚¹å‡è¿”å›404:
- `/records/batch_create`
- `/records/batch_update`
- `/records/batch_delete`

---

### 5. SQLæ‰§è¡ŒAPI âŒ **ä¸æ”¯æŒ**

æµ‹è¯•ç«¯ç‚¹:
- `POST /apaas/v1/workspaces/{workspace_id}/sql/execute` â†’ 404
- `POST /apaas/v1/workspaces/{workspace_id}/query` â†’ 404

**ç»“è®º**: aPaaSä¸æä¾›ç›´æ¥SQLæ‰§è¡Œæ¥å£

---

## ğŸ’¡ APIèƒ½åŠ›å¯¹æ¯”

### é£ä¹¦aPaaS Workspace API vs Bitable API

| åŠŸèƒ½ | aPaaS Workspace API | Bitable API |
|------|---------------------|-------------|
| åˆ—å‡ºè¡¨ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| åˆ—å‡ºå­—æ®µ | âš ï¸ ä»è¡¨ä¿¡æ¯è·å– | âœ… ç‹¬ç«‹endpoint |
| æŸ¥è¯¢è®°å½• | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| åˆ›å»ºè®°å½• | âŒ æ ¼å¼é—®é¢˜ | âœ… æ”¯æŒ |
| æ›´æ–°è®°å½• | âŒ æœªæ‰¾åˆ° | âœ… æ”¯æŒ |
| åˆ é™¤è®°å½• | âš ï¸ éœ€éªŒè¯ | âœ… æ”¯æŒ |
| æ‰¹é‡æ“ä½œ | âŒ æœªæ‰¾åˆ° | âœ… æ”¯æŒ |
| SQLæ‰§è¡Œ | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ |

---

## ğŸ¯ å›ç­”æ‚¨çš„é—®é¢˜

### é—®é¢˜1: æ˜¯å¦æœ‰æ¥å£å¯ä»¥æä¾›SQLæ‰§è¡Œæˆ–ç›¸å…³çš„æ›´æ–°æ¥å£?

**ç­”æ¡ˆ**: âŒ **æ²¡æœ‰**

**è¯¦ç»†è¯´æ˜**:
1. **SQLæ‰§è¡Œ**: aPaaS Workspace APIä¸æä¾›ç›´æ¥SQLæ‰§è¡Œæ¥å£
   - æµ‹è¯•çš„æ‰€æœ‰SQLç«¯ç‚¹å‡è¿”å›404
   - å®˜æ–¹æ–‡æ¡£ä¹ŸæœªæåŠSQLæ‰§è¡Œèƒ½åŠ›

2. **æ›´æ–°æ¥å£**:
   - âœ… æŸ¥è¯¢(GET)æ¥å£å®Œå…¨å¯ç”¨
   - âŒ åˆ›å»º(POST)æ¥å£å­˜åœ¨ä½†å‚æ•°æ ¼å¼æœ‰é—®é¢˜
   - âŒ æ›´æ–°(PUT/PATCH)æ¥å£æœªæ‰¾åˆ°
   - âš ï¸ åˆ é™¤(DELETE)æ¥å£éœ€è¿›ä¸€æ­¥éªŒè¯

### é—®é¢˜2: å¦‚æœæœ‰çš„è¯,æ˜¯å¦å¯ä»¥æ ¹æ®SQLæˆ–æ¡ä»¶æ€§æ“ä½œæ¥å®ŒæˆCRUDæ“ä½œ?

**ç­”æ¡ˆ**: âš ï¸ **éƒ¨åˆ†å¯ä»¥,ä½†æœ‰é™åˆ¶**

**å¯è¡Œçš„æ–¹æ¡ˆ**:

#### æ–¹æ¡ˆA: ä¸¤æ­¥æ³•å®ç°æ¡ä»¶æ€§æ“ä½œ âœ…
```python
# 1. æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„è®°å½•
records = client.query_records(
    table_id="follow_ups",
    page_size=500
)

# 2. åœ¨åº”ç”¨å±‚è¿‡æ»¤
filtered_records = [r for r in records if r['stage'] == 'æ½œåœ¨å®¢æˆ·']

# 3. é€æ¡æ“ä½œ(å¦‚æœæ‰¾åˆ°æ›´æ–°API)
for record in filtered_records:
    # client.update_record(record['id'], {...})  # éœ€è¦æ›´æ–°API
    pass
```

**é™åˆ¶**:
- âŒ æ— æ³•ä¸€æ¬¡æ€§æ¡ä»¶æ›´æ–°/åˆ é™¤
- âŒ éœ€è¦ä¸¤æ¬¡APIè°ƒç”¨
- âŒ å¤§æ•°æ®é‡æ€§èƒ½é—®é¢˜
- âš ï¸ å¹¶å‘å†™å…¥å†²çªé£é™©

#### æ–¹æ¡ˆB: åˆ‡æ¢åˆ°Bitable API âœ… **æ¨è**

å¦‚æœworkspaceå®é™…ä¸Šæ˜¯Bitableåº”ç”¨:
```python
# Bitable APIæä¾›å®Œæ•´CRUD
GET  /bitable/v1/apps/{app_token}/tables/{table_id}/records
POST /bitable/v1/apps/{app_token}/tables/{table_id}/records
PUT  /bitable/v1/apps/{app_token}/tables/{table_id}/records/{record_id}
DELETE /bitable/v1/apps/{app_token}/tables/{table_id}/records/{record_id}

# æ‰¹é‡æ“ä½œ
POST /bitable/v1/apps/{app_token}/tables/{table_id}/records/batch_create
POST /bitable/v1/apps/{app_token}/tables/{table_id}/records/batch_update
POST /bitable/v1/apps/{app_token}/tables/{table_id}/records/batch_delete
```

---

## ğŸ“Š å½“å‰å®ç°çŠ¶æ€

### å·²å®ç° âœ…
- `list_workspace_tables()` - 100%å·¥ä½œ
- `list_fields()` - 100%å·¥ä½œ

### å¯ä»¥å®ç° âš ï¸
- `query_records()` - APIå¯ç”¨,éœ€å®ç°è§£æé€»è¾‘

### æ— æ³•å®ç° âŒ
- `create_record()` - ç«¯ç‚¹å­˜åœ¨ä½†æ ¼å¼ä¸æ˜
- `update_record()` - ç«¯ç‚¹ä¸å­˜åœ¨
- `delete_record()` - éœ€è¿›ä¸€æ­¥éªŒè¯
- `batch_create_records()` - ç«¯ç‚¹ä¸å­˜åœ¨
- `batch_update_records()` - ç«¯ç‚¹ä¸å­˜åœ¨

---

## ğŸš€ å»ºè®®çš„å®æ–½æ–¹æ¡ˆ

### é€‰é¡¹1: ä»…å®ç°æŸ¥è¯¢åŠŸèƒ½ (å½“å‰å¯è¡Œ) âœ…

**å®ç°èŒƒå›´**:
- âœ… list_workspace_tables
- âœ… list_fields
- âœ… query_records (æ–°å¢)

**ä¼˜ç‚¹**:
- å®Œå…¨åŸºäºå·²éªŒè¯çš„API
- æ— é£é™©,ç¨³å®šå¯é 
- æ»¡è¶³å…ƒæ•°æ®æŸ¥è¯¢å’Œæ•°æ®è¯»å–éœ€æ±‚

**ç¼ºç‚¹**:
- æ— æ³•ä¿®æ”¹æ•°æ®
- åŠŸèƒ½ä¸å®Œæ•´

### é€‰é¡¹2: ç ”ç©¶Bitable APIå…¼å®¹æ€§ (éœ€éªŒè¯) âš ï¸

**éªŒè¯æ­¥éª¤**:
1. æµ‹è¯•workspace_idæ˜¯å¦å¯ä½œä¸ºapp_token
2. æµ‹è¯•Bitable APIçš„recordsç«¯ç‚¹
3. å¦‚æœå¯ç”¨,åˆ‡æ¢åˆ°Bitable API

**ä¼˜ç‚¹**:
- Bitable APIåŠŸèƒ½å®Œæ•´
- å®˜æ–¹æ–‡æ¡£å®Œå–„
- æ”¯æŒå®Œæ•´CRUD

**ç¼ºç‚¹**:
- éœ€è¦éªŒè¯å…¼å®¹æ€§
- å¯èƒ½éœ€è¦ä¸åŒçš„è®¤è¯æ–¹å¼

### é€‰é¡¹3: è”ç³»é£ä¹¦æŠ€æœ¯æ”¯æŒ (é•¿æœŸ) ğŸ“

**å’¨è¯¢å†…å®¹**:
1. aPaaS Workspace APIçš„å®Œæ•´æ–‡æ¡£
2. åˆ›å»º/æ›´æ–°è®°å½•çš„æ­£ç¡®æ ¼å¼
3. æ˜¯å¦æœ‰æœªå…¬å¼€çš„CRUDç«¯ç‚¹

---

## ğŸ“ˆ å»ºè®®çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ (æœ¬æ¬¡å¯å®Œæˆ)

1. âœ… **å®ç°query_records()**
   - APIå·²éªŒè¯å¯ç”¨
   - è§£æitems JSONå­—ç¬¦ä¸²
   - å®ç°åˆ†é¡µæ”¯æŒ

2. âœ… **æ›´æ–°æ–‡æ¡£è¯´æ˜**
   - æ˜ç¡®APIé™åˆ¶
   - è¯´æ˜ä»…æ”¯æŒè¯»å–æ“ä½œ
   - æä¾›workaroundå»ºè®®

3. âœ… **æäº¤å½“å‰å·¥ä½œ**
   - 3ä¸ªå·²å·¥ä½œçš„æ–¹æ³•
   - å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š
   - æ¸…æ™°çš„é™åˆ¶è¯´æ˜

### çŸ­æœŸè¡ŒåŠ¨ (éœ€è¦é¢å¤–ä¿¡æ¯)

4. âš ï¸ **éªŒè¯Bitable API**
   - æµ‹è¯•workspace_idå…¼å®¹æ€§
   - å¦‚æœå¯ç”¨,æä¾›åˆ‡æ¢æ–¹æ¡ˆ

5. âš ï¸ **ç ”ç©¶åˆ›å»ºAPIæ ¼å¼**
   - åˆ†æé”™è¯¯æ—¥å¿—é“¾æ¥
   - å°è¯•ä¸åŒçš„å­—æ®µæ ¼å¼
   - å¯èƒ½éœ€è¦æŸ¥çœ‹å®˜æ–¹ç¤ºä¾‹

### é•¿æœŸè¡ŒåŠ¨ (å¯é€‰)

6. ğŸ“ **è”ç³»é£ä¹¦æŠ€æœ¯æ”¯æŒ**
   - è·å–å®Œæ•´APIæ–‡æ¡£
   - ç¡®è®¤CRUDèƒ½åŠ›è·¯çº¿å›¾

---

## âœ… ç»“è®º

**å½“å‰çŠ¶æ€**:
- âœ… aPaaS Workspace API **æ”¯æŒå…ƒæ•°æ®æŸ¥è¯¢å’Œè®°å½•è¯»å–**
- âŒ aPaaS Workspace API **ä¸æ”¯æŒSQLæ‰§è¡Œ**
- âŒ aPaaS Workspace API **CRUDæ“ä½œä¸å®Œæ•´**

**å»ºè®®å®æ–½æ–¹æ¡ˆ**:
1. **çŸ­æœŸ**: å®ç° `query_records()`,æä¾›åªè¯»æ•°æ®è®¿é—®
2. **ä¸­æœŸ**: éªŒè¯Bitable APIå…¼å®¹æ€§
3. **é•¿æœŸ**: æ ¹æ®å®é™…éœ€æ±‚å†³å®šæ˜¯å¦éœ€è¦å®Œæ•´CRUD

**è¯„ä¼°**:
- å…ƒæ•°æ®åŠŸèƒ½: Açº§ (å®Œå…¨å¯ç”¨)
- æ•°æ®æŸ¥è¯¢åŠŸèƒ½: Açº§ (å®Œå…¨å¯ç”¨)
- æ•°æ®å†™å…¥åŠŸèƒ½: Dçº§ (åŸºæœ¬ä¸å¯ç”¨)
- **æ€»ä½“**: Bçº§ (è¯»å–ä¼˜ç§€,å†™å…¥å—é™)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-17
**æµ‹è¯•ç¯å¢ƒ**: é£ä¹¦aPaaSç”Ÿäº§ç¯å¢ƒ
**APIç‰ˆæœ¬**: v1
