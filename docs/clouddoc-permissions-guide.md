# CloudDoc æƒé™é…ç½®æŒ‡å—

**æ—¥æœŸ**: 2026-01-17
**ç‰ˆæœ¬**: v1.0.0

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜ CloudDoc æ¨¡å—ï¼ˆBitableã€Sheetã€Docï¼‰æ‰€éœ€çš„é£ä¹¦åº”ç”¨æƒé™é…ç½®ã€‚

---

## ğŸ”‘ Bitable å¤šç»´è¡¨æ ¼æƒé™

### æ‰€éœ€æƒé™ä½œç”¨åŸŸ

| æƒé™ | è¯´æ˜ | æ“ä½œ |
|------|------|------|
| `bitable:app` | æŸ¥çœ‹ã€è¯„è®ºã€ç¼–è¾‘å’Œç®¡ç†å¤šç»´è¡¨æ ¼ | **å¿…éœ€** |

### å…·ä½“æ“ä½œæƒé™

| API æ–¹æ³• | æƒé™è¦æ±‚ | è¯´æ˜ |
|---------|---------|------|
| `get_table_fields()` | `bitable:app` (åªè¯») | æŸ¥è¯¢è¡¨å­—æ®µä¿¡æ¯ |
| `query_records()` | `bitable:app` (åªè¯») | æŸ¥è¯¢è®°å½• |
| `query_records_structured()` | `bitable:app` (åªè¯») | ç»“æ„åŒ–æŸ¥è¯¢è®°å½• |
| **`create_record()`** | **`bitable:app` (ç¼–è¾‘)** | âš ï¸ åˆ›å»ºè®°å½• |
| **`update_record()`** | **`bitable:app` (ç¼–è¾‘)** | âš ï¸ æ›´æ–°è®°å½• |
| **`delete_record()`** | **`bitable:app` (ç¼–è¾‘)** | âš ï¸ åˆ é™¤è®°å½• |
| **`batch_create_records()`** | **`bitable:app` (ç¼–è¾‘)** | âš ï¸ æ‰¹é‡åˆ›å»ºè®°å½• |

### é…ç½®æ­¥éª¤

#### 1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®æƒé™

1. ç™»å½• [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. è¿›å…¥ä½ çš„åº”ç”¨ â†’ **æƒé™ç®¡ç†**
3. æœç´¢å¹¶æ·»åŠ æƒé™ï¼š
   - âœ… `bitable:app` - æŸ¥çœ‹ã€è¯„è®ºã€ç¼–è¾‘å’Œç®¡ç†å¤šç»´è¡¨æ ¼

4. **å‘å¸ƒæ–°ç‰ˆæœ¬**ï¼ˆæƒé™å˜æ›´åå¿…é¡»å‘å¸ƒï¼‰

#### 2. å°†åº”ç”¨æ·»åŠ ä¸ºå¤šç»´è¡¨æ ¼åä½œè€…

**æ–¹æ³• 1: é€šè¿‡å¤šç»´è¡¨æ ¼ç•Œé¢**
1. æ‰“å¼€å¤šç»´è¡¨æ ¼
2. ç‚¹å‡»å³ä¸Šè§’ **åˆ†äº«** â†’ **æ·»åŠ åä½œè€…**
3. æœç´¢ä½ çš„åº”ç”¨åç§°
4. é€‰æ‹©æƒé™ï¼š**å¯ç¼–è¾‘** âš ï¸
5. ç¡®è®¤æ·»åŠ 

**æ–¹æ³• 2: é€šè¿‡ API æ·»åŠ ï¼ˆéœ€è¦æ–‡æ¡£æ‰€æœ‰è€…æƒé™ï¼‰**
```python
# ä½¿ç”¨ DocClient çš„ grant_permission æ–¹æ³•
doc_client.grant_permission(
    app_id="cli_xxx",
    doc_token="bascnxxx",  # Bitable app_token
    member_type="app",
    member_id="cli_xxx",  # ä½ çš„åº”ç”¨ ID
    perm="edit"  # ç¼–è¾‘æƒé™
)
```

### å¸¸è§é”™è¯¯

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|--------|---------|------|---------|
| 1254302 | Permission denied | åº”ç”¨æœªè¢«æ·»åŠ ä¸ºåä½œè€… | æ·»åŠ åº”ç”¨ä¸ºåä½œè€… |
| 1254302 | Permission denied | åº”ç”¨åªæœ‰æŸ¥çœ‹æƒé™ | å‡çº§ä¸ºç¼–è¾‘æƒé™ |
| 1254301 | OperationTypeError | æƒé™æœªç”Ÿæ•ˆ | å‘å¸ƒæ–°ç‰ˆæœ¬ |

---

## ğŸ“Š Sheet ç”µå­è¡¨æ ¼æƒé™

### æ‰€éœ€æƒé™ä½œç”¨åŸŸ

| æƒé™ | è¯´æ˜ | æ“ä½œ |
|------|------|------|
| `sheets:spreadsheet` | æŸ¥çœ‹å’Œç¼–è¾‘ç”µå­è¡¨æ ¼ | **å¿…éœ€** |

### å…·ä½“æ“ä½œæƒé™

| API æ–¹æ³• | æƒé™è¦æ±‚ | è¯´æ˜ |
|---------|---------|------|
| `get_sheet_info()` | `sheets:spreadsheet` (åªè¯») | æŸ¥è¯¢å·¥ä½œè¡¨ä¿¡æ¯ |
| `get_sheet_data()` | `sheets:spreadsheet` (åªè¯») | è¯»å–æ•°æ® |
| **`update_range()`** | **`sheets:spreadsheet` (ç¼–è¾‘)** | âš ï¸ æ›´æ–°èŒƒå›´ |
| **`append_data()`** | **`sheets:spreadsheet` (ç¼–è¾‘)** | âš ï¸ è¿½åŠ æ•°æ® |
| **`batch_update()`** | **`sheets:spreadsheet` (ç¼–è¾‘)** | âš ï¸ æ‰¹é‡æ›´æ–° |

### é…ç½®æ­¥éª¤

#### 1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®æƒé™

1. è¿›å…¥åº”ç”¨ â†’ **æƒé™ç®¡ç†**
2. æ·»åŠ æƒé™ï¼š
   - âœ… `sheets:spreadsheet` - æŸ¥çœ‹å’Œç¼–è¾‘ç”µå­è¡¨æ ¼

3. **å‘å¸ƒæ–°ç‰ˆæœ¬**

#### 2. å°†åº”ç”¨æ·»åŠ ä¸ºç”µå­è¡¨æ ¼åä½œè€…

1. æ‰“å¼€ç”µå­è¡¨æ ¼
2. ç‚¹å‡»å³ä¸Šè§’ **åˆ†äº«** â†’ **æ·»åŠ åä½œè€…**
3. æœç´¢ä½ çš„åº”ç”¨
4. é€‰æ‹©æƒé™ï¼š**å¯ç¼–è¾‘** âš ï¸
5. ç¡®è®¤æ·»åŠ 

---

## ğŸ“„ CloudDoc äº‘æ–‡æ¡£æƒé™

### æ‰€éœ€æƒé™ä½œç”¨åŸŸ

| æƒé™ | è¯´æ˜ | æ“ä½œ |
|------|------|------|
| `docx:document` | æŸ¥çœ‹å’Œç¼–è¾‘äº‘æ–‡æ¡£ | **å¿…éœ€** |
| `docx:document:readonly` | ä»…æŸ¥çœ‹äº‘æ–‡æ¡£ | åªè¯»æ“ä½œ |

### å…·ä½“æ“ä½œæƒé™

| API æ–¹æ³• | æƒé™è¦æ±‚ | è¯´æ˜ |
|---------|---------|------|
| `get_document()` | `docx:document:readonly` | æŸ¥è¯¢æ–‡æ¡£ä¿¡æ¯ |
| `get_blocks()` | `docx:document:readonly` | è¯»å–å†…å®¹å— |
| **`append_blocks()`** | **`docx:document`** | âš ï¸ è¿½åŠ å†…å®¹ |
| **`update_block()`** | **`docx:document`** | âš ï¸ æ›´æ–°å†…å®¹å— |
| **`delete_block()`** | **`docx:document`** | âš ï¸ åˆ é™¤å†…å®¹å— |
| **`grant_permission()`** | **`docx:document` + æ‰€æœ‰è€…** | âš ï¸ æˆäºˆæƒé™ |
| **`revoke_permission()`** | **`docx:document` + æ‰€æœ‰è€…** | âš ï¸ æ’¤é”€æƒé™ |

### é…ç½®æ­¥éª¤

#### 1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®æƒé™

1. è¿›å…¥åº”ç”¨ â†’ **æƒé™ç®¡ç†**
2. æ·»åŠ æƒé™ï¼š
   - âœ… `docx:document` - æŸ¥çœ‹å’Œç¼–è¾‘äº‘æ–‡æ¡£

3. **å‘å¸ƒæ–°ç‰ˆæœ¬**

#### 2. å°†åº”ç”¨æ·»åŠ ä¸ºæ–‡æ¡£åä½œè€…

1. æ‰“å¼€äº‘æ–‡æ¡£
2. ç‚¹å‡»å³ä¸Šè§’ **åˆ†äº«** â†’ **æ·»åŠ åä½œè€…**
3. æœç´¢ä½ çš„åº”ç”¨
4. é€‰æ‹©æƒé™ï¼š**å¯ç¼–è¾‘** âš ï¸
5. ç¡®è®¤æ·»åŠ 

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æƒé™ç”Ÿæ•ˆæ—¶é—´

- æƒé™é…ç½®åï¼Œ**å¿…é¡»å‘å¸ƒæ–°ç‰ˆæœ¬**æ‰èƒ½ç”Ÿæ•ˆ
- å‘å¸ƒåï¼Œå·²å®‰è£…çš„åº”ç”¨éœ€è¦**é‡æ–°æˆæƒ**
- å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯æƒé™é…ç½®

### 2. åä½œè€…æƒé™çº§åˆ«

| æƒé™çº§åˆ« | å¯æ‰§è¡Œæ“ä½œ |
|---------|-----------|
| **å¯æŸ¥çœ‹** | åªèƒ½è¯»å–æ•°æ® |
| **å¯è¯„è®º** | å¯æŸ¥çœ‹ + è¯„è®º |
| **å¯ç¼–è¾‘** | å¯æŸ¥çœ‹ + è¯„è®º + ç¼–è¾‘ âš ï¸ **æ¨è** |
| **å¯ç®¡ç†** | å…¨éƒ¨æƒé™ + æƒé™ç®¡ç† |

**å»ºè®®:** ä¸ºåº”ç”¨åˆ†é… **å¯ç¼–è¾‘** æƒé™å³å¯æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ã€‚

### 3. é”™è¯¯å¤„ç†

æ‰€æœ‰å†™æ“ä½œéƒ½å¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š

```python
from lark_service.core.exceptions import (
    PermissionDeniedError,  # æƒé™ä¸è¶³
    InvalidParameterError,  # å‚æ•°é”™è¯¯
    NotFoundError,          # èµ„æºä¸å­˜åœ¨
    APIError,               # API è°ƒç”¨å¤±è´¥
)

try:
    record = bitable_client.create_record(...)
except PermissionDeniedError:
    # å¤„ç†æƒé™ä¸è¶³ï¼šæ£€æŸ¥åº”ç”¨æ˜¯å¦è¢«æ·»åŠ ä¸ºåä½œè€…
    print("è¯·å°†åº”ç”¨æ·»åŠ ä¸ºå¤šç»´è¡¨æ ¼çš„åä½œè€…ï¼Œå¹¶æˆäºˆç¼–è¾‘æƒé™")
except InvalidParameterError as e:
    # å¤„ç†å‚æ•°é”™è¯¯ï¼šæ£€æŸ¥å­—æ®µåç§°å’Œç±»å‹
    print(f"å‚æ•°é”™è¯¯: {e}")
```

### 4. æµ‹è¯•æƒé™é…ç½®

ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æµ‹è¯•æƒé™æ˜¯å¦æ­£ç¡®é…ç½®ï¼š

```python
from lark_service.clouddoc.bitable.client import BitableClient
from lark_service.core.credential_pool import CredentialPool

# åˆå§‹åŒ–å®¢æˆ·ç«¯
pool = CredentialPool()
client = BitableClient(pool)

# æµ‹è¯•è¯»æƒé™
try:
    fields = client.get_table_fields(
        app_id="cli_xxx",
        app_token="bascnxxx",
        table_id="tblxxx"
    )
    print("âœ… è¯»æƒé™æ­£å¸¸")
except Exception as e:
    print(f"âŒ è¯»æƒé™å¤±è´¥: {e}")

# æµ‹è¯•å†™æƒé™
try:
    record = client.create_record(
        app_id="cli_xxx",
        app_token="bascnxxx",
        table_id="tblxxx",
        fields={"æµ‹è¯•å­—æ®µ": "æµ‹è¯•å€¼"}
    )
    print("âœ… å†™æƒé™æ­£å¸¸")

    # æ¸…ç†æµ‹è¯•æ•°æ®
    client.delete_record(
        app_id="cli_xxx",
        app_token="bascnxxx",
        table_id="tblxxx",
        record_id=record.record_id
    )
except Exception as e:
    print(f"âŒ å†™æƒé™å¤±è´¥: {e}")
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [é£ä¹¦å¼€æ”¾å¹³å° - æƒé™ç®¡ç†](https://open.feishu.cn/document/home/introduction-to-scope-and-authorization/list-of-permissions-by-feature)
- [Bitable API æ–‡æ¡£](https://open.feishu.cn/document/server-docs/docs/bitable-v1/app-table-record/create)
- [Sheet API æ–‡æ¡£](https://open.feishu.cn/document/server-docs/docs/sheets-v3/data-operation/write-data)
- [CloudDoc API æ–‡æ¡£](https://open.feishu.cn/document/server-docs/docs/docs/docx-v1/document-docx/create)

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

ä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿æƒé™é…ç½®æ­£ç¡®ï¼š

- [ ] åœ¨é£ä¹¦å¼€æ”¾å¹³å°æ·»åŠ äº†æ‰€éœ€æƒé™
- [ ] å‘å¸ƒäº†æ–°ç‰ˆæœ¬ï¼ˆæƒé™å˜æ›´åï¼‰
- [ ] å°†åº”ç”¨æ·»åŠ ä¸ºæ–‡æ¡£/è¡¨æ ¼çš„åä½œè€…
- [ ] æˆäºˆäº† **å¯ç¼–è¾‘** æƒé™
- [ ] æµ‹è¯•äº†è¯»æ“ä½œï¼ˆget/queryï¼‰
- [ ] æµ‹è¯•äº†å†™æ“ä½œï¼ˆcreate/update/deleteï¼‰
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆæ•è· PermissionDeniedErrorï¼‰

---

**æœ€åæ›´æ–°**: 2026-01-17
**ç»´æŠ¤è€…**: LarkService Team
