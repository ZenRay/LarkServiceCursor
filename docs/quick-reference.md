# ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·å¿«é€Ÿå‚è€ƒ

## ğŸ¯ æ ¸å¿ƒå‘½ä»¤

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. ä¿®æ”¹ä»£ç åï¼Œæ™ºèƒ½æ·»åŠ å¹¶æ£€æŸ¥
git cadd <files>              # è‡ªåŠ¨æ ¼å¼åŒ– â†’ æ·»åŠ  â†’ æ£€æŸ¥

# 2. æäº¤å‰è¿è¡Œå®Œæ•´æ£€æŸ¥ï¼ˆæ¨èï¼‰
git check                     # ä¸ CI å®Œå…¨ç›¸åŒçš„æ£€æŸ¥æ ‡å‡†

# 3. æäº¤ï¼ˆè‡ªåŠ¨åŒæ­¥æš‚å­˜åŒºï¼‰
git csync -m "your message"   # é˜²æ­¢æš‚å­˜åŒº/å·¥ä½œåŒºä¸ä¸€è‡´
```

### è¾…åŠ©å‘½ä»¤

```bash
git fmt <files>               # ä»…æ ¼å¼åŒ–ä»£ç 
git cfmt <files>              # ä»…æ£€æŸ¥æ ¼å¼ï¼ˆä¸ä¿®æ”¹ï¼‰
./scripts/check-all.sh        # ç›´æ¥è¿è¡Œæ£€æŸ¥è„šæœ¬
```

---

## ğŸ“‹ æ£€æŸ¥å†…å®¹è¯¦è§£

### git check ä¼šè¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

| æ­¥éª¤ | æ£€æŸ¥é¡¹ | ç›®æ ‡ | é…ç½® |
|------|--------|------|------|
| 1 | Ruff Linting | src/ + tests/ | ä»£ç è§„èŒƒ |
| 2 | Ruff Formatting | src/ + tests/ | ä»£ç æ ¼å¼ |
| 3 | Mypy (ä¸¥æ ¼) | **src/** | `--strict` |
| 4 | Mypy (å®½æ¾) | **tests/** | å¿½ç•¥ç±»å‹æ³¨è§£ |
| 5 | Bandit | src/ + tests/ | å®‰å…¨æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰|

### å…³é”®é…ç½®å·®å¼‚

**src/** - ä¸¥æ ¼æ¨¡å¼ï¼š
- âœ… å¿…é¡»æœ‰å®Œæ•´ç±»å‹æ³¨è§£
- âœ… ä¸¥æ ¼çš„ mypy æ£€æŸ¥
- âœ… ä¸å…è®¸ Any è¿”å›å€¼

**tests/** - å®½æ¾æ¨¡å¼ï¼š
- âœ… å…è®¸æ— ç±»å‹æ³¨è§£çš„æµ‹è¯•å‡½æ•°
- âœ… å…è®¸ Any è¿”å›å€¼
- âœ… å¿½ç•¥ `no-untyped-def`ã€`misc` ç­‰

---

## âš™ï¸ é…ç½®æ–‡ä»¶å¯¹åº”å…³ç³»

| å·¥å…· | æœ¬åœ°å‘½ä»¤ | Pre-commit Hook | GitHub Actions |
|------|----------|-----------------|----------------|
| Ruff | `ruff check` | `.pre-commit-config.yaml` | `.github/workflows/` |
| Mypy src/ | `mypy --strict` | `mypy-src` hook | åŒå·¦ |
| Mypy tests/ | `mypy` + å®½æ¾å‚æ•° | `mypy-tests` hook | åŒå·¦ |

**ä¸€è‡´æ€§ä¿è¯**ï¼š`git check` ä½¿ç”¨çš„å‚æ•°ä¸ pre-commit hooks **å®Œå…¨ç›¸åŒ**ã€‚

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ¬åœ° mypy é€šè¿‡ï¼Œä½† commit å¤±è´¥ï¼Ÿ

**åŸå› **ï¼šPre-commit hooks æ£€æŸ¥çš„æ˜¯**æš‚å­˜åŒº**ï¼Œä¸æ˜¯å·¥ä½œåŒºã€‚

**è§£å†³**ï¼šä½¿ç”¨ `git csync` æäº¤ï¼Œè‡ªåŠ¨åŒæ­¥æš‚å­˜åŒºã€‚

```bash
# âŒ é”™è¯¯æ–¹å¼
git add file.py
# ... ç¼–è¾‘å™¨è‡ªåŠ¨ä¿å­˜ ...
git commit              # æ£€æŸ¥çš„æ˜¯æ—§ç‰ˆæœ¬ï¼

# âœ… æ­£ç¡®æ–¹å¼
git cadd file.py        # æ™ºèƒ½æ·»åŠ 
git csync -m "msg"      # è‡ªåŠ¨åŒæ­¥åæäº¤
```

### Q2: tests/ çš„ç±»å‹æ³¨è§£é”™è¯¯è¦ä¿®å¤å—ï¼Ÿ

**ä¸éœ€è¦**ã€‚è¿™äº›æ˜¯æµ‹è¯•ä»£ç ï¼Œç±»å‹æ£€æŸ¥ä¼˜å…ˆçº§ä½ã€‚

æœ¬åœ°è¿è¡Œ `git check` æ—¶ä¼šè‡ªåŠ¨å¿½ç•¥è¿™äº›è­¦å‘Šï¼š
```
âœ“ Mypy (tests/) é€šè¿‡ï¼ˆå·²å¿½ç•¥ 17 ä¸ªç±»å‹æ³¨è§£è­¦å‘Šï¼‰
```

### Q3: å¦‚ä½•åªæ£€æŸ¥ç‰¹å®šç›®å½•ï¼Ÿ

```bash
# åªæ£€æŸ¥ src/
git check src/

# åªæ£€æŸ¥ tests/
git check "" tests/

# è‡ªå®šä¹‰
./scripts/check-all.sh src/lark_service/apaas/ tests/unit/
```

---

## ğŸ“– å®Œæ•´å·¥ä½œæµç¤ºä¾‹

```bash
# 1. ä¿®æ”¹ä»£ç 
vim src/lark_service/apaas/client.py

# 2. æ™ºèƒ½æ·»åŠ ï¼ˆè‡ªåŠ¨æ ¼å¼åŒ– + æ£€æŸ¥ï¼‰
git cadd src/lark_service/apaas/client.py

# 3. è¿è¡Œå®Œæ•´æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
git check

# 4. æäº¤ï¼ˆè‡ªåŠ¨åŒæ­¥æš‚å­˜åŒºï¼‰
git csync -m "feat(apaas): add new feature"

# 5. æ¨é€
git push
```

---

## ğŸš€ é¦–æ¬¡è®¾ç½®

è¿è¡Œä¸€æ¬¡å³å¯ï¼š

```bash
./scripts/setup-git-add-check.sh
```

è¿™ä¼šé…ç½®æ‰€æœ‰ Git aliases å’Œ pre-commit hooksã€‚

---

## ğŸ“š æ›´å¤šä¿¡æ¯

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š`docs/dev-workflow.md`
