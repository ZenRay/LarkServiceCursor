# ============================================
# 集成测试环境变量配置示例
# ============================================
# 使用方法:
# 1. 复制此文件到项目根目录并重命名为 .env.test
#    cp docs/env.test.example .env.test
# 2. 填入实际的配置值
# 3. 确保 .env.test 已添加到 .gitignore (已配置)
# ============================================

# ============================================
# PostgreSQL 配置 (Token 存储和用户缓存)
# ============================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=lark_service
POSTGRES_USER=lark
POSTGRES_PASSWORD=lark_password_123

# ============================================
# RabbitMQ 配置 (消息队列)
# ============================================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=lark
RABBITMQ_PASSWORD=rabbitmq_password_123

# ============================================
# 加密密钥配置
# ============================================
# 生成方式: openssl rand -base64 32
LARK_CONFIG_ENCRYPTION_KEY=CHANGE_THIS_TO_RANDOM_32_BYTE_KEY

# ============================================
# 日志配置
# ============================================
LOG_LEVEL=DEBUG

# ============================================
# 集成测试专用配置
# ============================================

# 飞书应用凭证 (必需)
TEST_APP_ID=cli_XXXXXXXXXXXXXXXX
TEST_APP_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Contact 模块测试数据
TEST_USER_EMAIL=test@yourcompany.com           # 必需: 用于测试邮箱查询
TEST_USER_MOBILE=+8613800138000                # 可选: 用于测试手机号查询
TEST_USER_ID=ou_XXXXXXXXXXXXXXXX               # 可选: 已知的用户 ID
TEST_DEPARTMENT_ID=od_XXXXXXXXXXXXXXXX         # 可选: 用于测试部门查询
TEST_CHAT_ID=oc_XXXXXXXXXXXXXXXX               # 可选: 用于测试群组查询

# CloudDoc 模块测试数据 (可选,用于读操作测试)
TEST_DOC_TOKEN=doxcnXXXXXXXXXXXXXXXXXXXX      # 测试文档 ID (需要读权限)
TEST_BITABLE_APP_TOKEN=bascnXXXXXXXXXXXXXX    # 测试多维表格 ID (需要读权限)
TEST_SHEET_TOKEN=shtcnXXXXXXXXXXXXXXXXXXXX    # 测试电子表格 ID (需要读权限)

# CloudDoc 写操作测试数据 (可选,用于写操作测试)
TEST_WRITABLE_DOC_TOKEN=doxcnXXXXXXXXXXXXXX   # 有写权限的测试文档
TEST_WRITABLE_BITABLE_TOKEN=bascnXXXXXXXXXX   # 有写权限的测试多维表格
TEST_WRITABLE_SHEET_TOKEN=shtcnXXXXXXXXXXXX   # 有写权限的测试电子表格

# ============================================
# 重要说明
# ============================================
#
# 1. 飞书应用权限要求:
#
#    Contact 模块:
#    - contact:user.email:readonly (通过邮箱查询用户)
#    - contact:user.phone:readonly (通过手机号查询用户)
#    - contact:user.employee_id:readonly (通过 user_id 查询)
#    - contact:user.id:readonly (获取用户 open_id)
#    - contact:department.list (查询部门列表)
#    - im:chat:readonly (查询群组信息)
#
#    CloudDoc 模块 (读操作):
#    - docx:document:readonly (读取文档)
#    - bitable:app:readonly (读取多维表格)
#    - sheets:spreadsheet:readonly (读取电子表格)
#
#    CloudDoc 模块 (写操作,可选):
#    - docx:document (创建和编辑文档)
#    - bitable:app (创建和编辑多维表格)
#    - sheets:spreadsheet (编辑电子表格)
#
# 2. 测试数据获取:
#
#    - TEST_USER_EMAIL: 使用你的飞书企业内的真实用户邮箱
#    - TEST_DOC_TOKEN: 在飞书文档中打开任意文档,URL 中的 ID
#      例如: https://xxx.feishu.cn/docx/doxcnXXXXXXXXXXXX
#    - TEST_BITABLE_APP_TOKEN: 多维表格的 app_token
#      例如: https://xxx.feishu.cn/base/bascnXXXXXXXXXXXX
#
# 3. 安全提示:
#
#    - .env.test 文件包含敏感信息,已添加到 .gitignore
#    - 请勿提交到版本控制系统
#    - 生产环境使用不同的凭证
#    - 定期轮换密钥和密码
#
# 4. 启动基础设施:
#
#    docker-compose up -d postgres rabbitmq
#
# 5. 运行集成测试:
#
#    # 运行所有测试
#    pytest tests/integration/ -v
#
#    # 只运行 Contact 测试
#    pytest tests/integration/test_contact_e2e.py -v
#
#    # 只运行 CloudDoc 测试
#    pytest tests/integration/test_clouddoc_e2e.py -v
