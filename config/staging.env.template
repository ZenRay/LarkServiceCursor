# ============================================================================
# Lark Service - Staging Environment Configuration Template
# ============================================================================
#
# 说明:
# 1. 复制此文件到项目根目录并重命名为 .env.staging
# 2. 填写实际的密钥和配置值
# 3. 确保 .env.staging 不被提交到版本控制
#
# 安全提醒:
# - 所有包含 SECRET/KEY/PASSWORD 的值必须使用强随机值
# - 不要在生产环境重用开发环境的密钥
# - 定期轮换密钥 (建议每季度一次)
# ============================================================================

# ----------------------------------------------------------------------------
# 1. 应用基础配置
# ----------------------------------------------------------------------------

# 环境标识 (development/staging/production)
ENVIRONMENT=staging

# 应用名称
APP_NAME=lark-service

# 日志级别 (DEBUG/INFO/WARNING/ERROR/CRITICAL)
LOG_LEVEL=INFO

# 日志格式 (json/text)
# staging/production建议使用json便于日志聚合分析
LOG_FORMAT=json

# 时区设置
TZ=Asia/Shanghai

# ----------------------------------------------------------------------------
# 2. PostgreSQL 数据库配置 (Token & User Cache Storage)
# ----------------------------------------------------------------------------

# 数据库连接信息
DB_HOST=staging-db.example.com
DB_PORT=5432
DB_NAME=lark_service_staging
DB_USER=lark_staging
DB_PASSWORD=<REPLACE_WITH_STRONG_PASSWORD>

# 数据库连接池配置 (FR-120)
DB_POOL_SIZE=10              # 连接池大小 (staging建议5-10)
DB_POOL_MAX_OVERFLOW=20      # 最大溢出连接数
DB_POOL_TIMEOUT=30           # 获取连接超时(秒)
DB_POOL_RECYCLE=3600         # 连接最大生命周期(秒, 1小时)
DB_ECHO=false                # 是否打印SQL语句 (staging建议false)

# 数据库 SSL 配置 (生产环境建议启用)
DB_SSL_MODE=prefer           # disable/allow/prefer/require/verify-ca/verify-full

# ----------------------------------------------------------------------------
# 3. 飞书 API 配置
# ----------------------------------------------------------------------------

# 飞书开放平台域名
FEISHU_API_BASE_URL=https://open.feishu.cn

# 飞书应用凭证 (必填 - 从飞书开放平台获取)
# 获取步骤:
# 1. 访问 https://open.feishu.cn/app
# 2. 创建企业自建应用
# 3. 进入"凭证与基础信息"页面获取
LARK_APP_ID=<REPLACE_WITH_YOUR_APP_ID>
LARK_APP_SECRET=<REPLACE_WITH_YOUR_APP_SECRET>

# 飞书 Webhook 回调验证 Token (在飞书开放平台配置)
FEISHU_WEBHOOK_VERIFICATION_TOKEN=<REPLACE_WITH_FEISHU_VERIFICATION_TOKEN>

# 飞书卡片回调签名密钥 (在飞书开放平台配置)
FEISHU_CARD_ENCRYPT_KEY=<REPLACE_WITH_FEISHU_ENCRYPT_KEY>

# API 超时配置 (秒)
FEISHU_API_TIMEOUT=30

# API 重试配置
FEISHU_API_MAX_RETRIES=3
FEISHU_API_RETRY_BACKOFF_FACTOR=2

# ----------------------------------------------------------------------------
# 4. Token 管理配置
# ----------------------------------------------------------------------------

# Token 刷新阈值 (秒, 提前多久刷新token)
TOKEN_REFRESH_THRESHOLD=600

# Token 加密密钥 (Fernet key)
# 生成方式: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
TOKEN_ENCRYPTION_KEY=<REPLACE_WITH_FERNET_KEY>

# Token 存储类型 (postgres/memory)
TOKEN_STORAGE_TYPE=postgres

# ----------------------------------------------------------------------------
# 5. 监控和可观测性配置
# ----------------------------------------------------------------------------

# Prometheus metrics 端口
METRICS_PORT=9090
METRICS_ENABLED=true

# Sentry 错误追踪 (可选)
SENTRY_DSN=<REPLACE_WITH_SENTRY_DSN>
SENTRY_ENVIRONMENT=staging
SENTRY_TRACES_SAMPLE_RATE=0.1

# ----------------------------------------------------------------------------
# 6. 备份和恢复配置
# ----------------------------------------------------------------------------

# 备份存储路径
BACKUP_DIR=/backup/lark-service
BACKUP_RETENTION_DAYS=30

# 备份加密密钥 (GPG)
BACKUP_ENCRYPTION_KEY=<REPLACE_WITH_GPG_KEY_ID>

# ============================================================================
