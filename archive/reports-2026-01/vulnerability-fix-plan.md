# ä¾èµ–åŒ…å®‰å…¨æ¼æ´ä¿®å¤æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**åˆ›å»ºæ—¶é—´**: 2026-01-18
**ä¼˜å…ˆçº§**: P0 (é«˜å±æ¼æ´éœ€åœ¨1å‘¨å†…ä¿®å¤)
**é¢„è®¡è€—æ—¶**: 2-3å°æ—¶

---

## ğŸ“‹ æ¼æ´æ¸…å•

æ ¹æ® `pip-audit` æ‰«æç»“æœ,å‘ç° **11ä¸ªä¾èµ–æ¼æ´**:

| åŒ…å | å½“å‰ç‰ˆæœ¬ | æ¼æ´ID | ä¿®å¤ç‰ˆæœ¬ | CVSS | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|------|----------|--------|----------|------|----------|------|
| **urllib3** | 2.3.0 | CVE-2025-66418 | 2.6.0 | é«˜ | ğŸ”´ HIGH | è§£å‹ç¼©ç‚¸å¼¹æ”»å‡» |
| **urllib3** | 2.3.0 | CVE-2025-66471 | 2.6.0 | é«˜ | ğŸ”´ HIGH | æµå¼è§£å‹èµ„æºæ¶ˆè€— |
| **urllib3** | 2.3.0 | CVE-2026-21441 | 2.6.3 | é«˜ | ğŸ”´ HIGH | é‡å®šå‘è§£å‹ç‚¸å¼¹ |
| **urllib3** | 2.3.0 | CVE-2025-50181 | 2.5.0 | ä¸­ | ğŸŸ¡ MEDIUM | é‡å®šå‘æ§åˆ¶å¤±æ•ˆ |
| **urllib3** | 2.3.0 | CVE-2025-50182 | 2.5.0 | ä¸­ | ğŸŸ¡ MEDIUM | Pyodideé‡å®šå‘é—®é¢˜ |
| **setuptools** | 72.1.0 | PYSEC-2025-49 | 78.1.1 | é«˜ | ğŸ”´ HIGH | è·¯å¾„éå†RCEé£é™© |
| **requests** | 2.32.3 | CVE-2024-47081 | 2.32.4 | ä¸­ | ğŸŸ¡ MEDIUM | .netrcå‡­è¯æ³„æ¼ |
| **pynacl** | 1.5.0 | CVE-2025-69277 | 1.6.2 | ä½ | ğŸŸ¢ LOW | libsodiumè¾¹ç¼˜æ¡ˆä¾‹ |
| **werkzeug** | 3.1.3 | CVE-2025-66221 | 3.1.4 | ä¸­ | ğŸŸ¡ MEDIUM | Windowsè®¾å¤‡åDoS |
| **werkzeug** | 3.1.3 | CVE-2026-21860 | 3.1.5 | ä¸­ | ğŸŸ¡ MEDIUM | Windowsè®¾å¤‡åæ‰©å±• |
| **scrapy** | 2.12.0 | PYSEC-2017-83 | N/A | ä¸­ | ğŸŸ¡ MEDIUM | å¤§æ–‡ä»¶DoSæ”»å‡» |

**é«˜å±æ¼æ´**: 6ä¸ª (urllib3 x5 + setuptools x1)
**ä¸­å±æ¼æ´**: 4ä¸ª (requests + werkzeug x2 + scrapy)
**ä½å±æ¼æ´**: 1ä¸ª (pynacl)

---

## ğŸ¯ ä¿®å¤ç­–ç•¥

### ç­–ç•¥A: ç«‹å³ä¿®å¤æ‰€æœ‰é«˜å±æ¼æ´ (æ¨è) â­

**é€‚ç”¨åœºæ™¯**: ç”Ÿäº§éƒ¨ç½²å‰å¿…é¡»ä¿®å¤
**è€—æ—¶**: 2å°æ—¶

```bash
#!/bin/bash
#
# é«˜å±æ¼æ´ä¿®å¤è„šæœ¬
#

echo "========================================="
echo "ä¿®å¤é«˜å±ä¾èµ–æ¼æ´"
echo "========================================="
echo ""

# 1. æ›´æ–°é«˜å±æ¼æ´åŒ…
echo "[1/5] æ›´æ–° urllib3..."
pip install --upgrade 'urllib3>=2.6.3,<3.0.0'

echo "[2/5] æ›´æ–° setuptools..."
pip install --upgrade 'setuptools>=78.1.1'

echo "[3/5] æ›´æ–° requests..."
pip install --upgrade 'requests>=2.32.4,<3.0.0'

echo "[4/5] æ›´æ–° pynacl..."
pip install --upgrade 'pynacl>=1.6.2'

echo "[5/5] æ›´æ–° werkzeug..."
pip install --upgrade 'werkzeug>=3.1.5,<4.0.0'

echo ""
echo "ä¾èµ–æ›´æ–°å®Œæˆ!"
echo ""

# 2. è¿è¡Œæµ‹è¯•éªŒè¯
echo "========================================="
echo "è¿è¡Œæµ‹è¯•éªŒè¯"
echo "========================================="
echo ""

pytest tests/unit -v --tb=short

if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!"
    echo ""
else
    echo ""
    echo "âš ï¸  éƒ¨åˆ†æµ‹è¯•å¤±è´¥,è¯·æ£€æŸ¥æ—¥å¿—"
    echo ""
    exit 1
fi

# 3. é‡æ–°æ‰«æéªŒè¯
echo "========================================="
echo "é‡æ–°æ‰«æéªŒè¯"
echo "========================================="
echo ""

pip-audit --desc | grep -E "urllib3|setuptools|requests|pynacl|werkzeug"

if [ $? -ne 0 ]; then
    echo "âœ… é«˜å±æ¼æ´å·²å…¨éƒ¨ä¿®å¤!"
else
    echo "âš ï¸  ä»æœ‰æ¼æ´å­˜åœ¨,è¯·æ£€æŸ¥"
fi

echo ""

# 4. æ›´æ–° requirements.txt
echo "========================================="
echo "æ›´æ–° requirements.txt"
echo "========================================="
echo ""

pip freeze > requirements.txt
echo "âœ… requirements.txt å·²æ›´æ–°"

echo ""
echo "========================================="
echo "ä¿®å¤å®Œæˆ!"
echo "========================================="
echo ""
echo "ä¸‹ä¸€æ­¥:"
echo "  1. git add requirements.txt"
echo "  2. git commit -m 'fix: ä¿®å¤ä¾èµ–åŒ…å®‰å…¨æ¼æ´'"
echo ""
```

**æ‰§è¡Œæ–¹å¼**:
```bash
# ä¿å­˜ä¸Šè¿°è„šæœ¬ä¸º scripts/fix-vulnerabilities.sh
chmod +x scripts/fix-vulnerabilities.sh
./scripts/fix-vulnerabilities.sh
```

---

### ç­–ç•¥B: åˆ†é˜¶æ®µä¿®å¤ (ä¿å®ˆæ–¹æ¡ˆ)

**é˜¶æ®µ1**: ä¿®å¤é«˜å±æ¼æ´ (ç«‹å³æ‰§è¡Œ)
```bash
pip install --upgrade urllib3>=2.6.3 setuptools>=78.1.1
pytest tests/unit -v
pip freeze > requirements.txt
```

**é˜¶æ®µ2**: ä¿®å¤ä¸­å±æ¼æ´ (3å¤©å†…)
```bash
pip install --upgrade requests>=2.32.4 werkzeug>=3.1.5
pytest tests/unit -v
pip freeze > requirements.txt
```

**é˜¶æ®µ3**: ä¿®å¤ä½å±æ¼æ´ (1å‘¨å†…)
```bash
pip install --upgrade pynacl>=1.6.2
pytest tests/unit -v
pip freeze > requirements.txt
```

---

### ç­–ç•¥C: æ‰‹åŠ¨é€ä¸ªä¿®å¤ (æœ€ä¿å®ˆ)

é€‚ç”¨äºé£é™©æ•æ„Ÿçš„ç”Ÿäº§ç¯å¢ƒ,æ¯æ¬¡åªæ›´æ–°ä¸€ä¸ªåŒ…å¹¶éªŒè¯ã€‚

**æ­¥éª¤**:
1. æ›´æ–°ä¸€ä¸ªåŒ…
2. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ (unit + integration)
3. éªŒè¯åŠŸèƒ½æ­£å¸¸
4. æäº¤å˜æ›´
5. é‡å¤ä¸Šè¿°æ­¥éª¤

**ä¼˜ç‚¹**: æœ€å°åŒ–é£é™©
**ç¼ºç‚¹**: è€—æ—¶æœ€é•¿ (4-6å°æ—¶)

---

## ğŸ” è¯¦ç»†ä¿®å¤æŒ‡å—

### 1. urllib3 (5ä¸ªCVE,æœ€é«˜ä¼˜å…ˆçº§) ğŸ”´

**å½“å‰ç‰ˆæœ¬**: 2.3.0
**ç›®æ ‡ç‰ˆæœ¬**: 2.6.3 (ä¿®å¤æ‰€æœ‰5ä¸ªCVE)

**æ¼æ´è¯¦æƒ…**:
- **CVE-2025-66418**: è§£å‹ç¼©é“¾è¿‡é•¿å¯¼è‡´CPU/å†…å­˜è€—å°½
- **CVE-2025-66471**: æµå¼è§£å‹æ—¶è¿‡åº¦è§£å‹å¯¼è‡´èµ„æºæ¶ˆè€—
- **CVE-2026-21441**: é‡å®šå‘å“åº”è‡ªåŠ¨è§£å‹å¯¼è‡´ç‚¸å¼¹æ”»å‡»
- **CVE-2025-50181**: PoolManagerå±‚çº§é‡å®šå‘æ§åˆ¶å¤±æ•ˆ
- **CVE-2025-50182**: Pyodideè¿è¡Œæ—¶é‡å®šå‘è¡Œä¸ºä¸ä¸€è‡´

**ä¿®å¤å‘½ä»¤**:
```bash
pip install --upgrade 'urllib3>=2.6.3,<3.0.0'
```

**éªŒè¯**:
```bash
python3 -c "import urllib3; print(f'urllib3 version: {urllib3.__version__}')"
# åº”è¾“å‡º: urllib3 version: 2.6.3 (æˆ–æ›´é«˜)
```

**å…¼å®¹æ€§**:
- âœ… urllib3 2.6.3 å‘åå…¼å®¹ 2.x API
- âš ï¸ æ³¨æ„: å¦‚æœ‰è‡ªå®šä¹‰é‡å®šå‘é€»è¾‘,éœ€æµ‹è¯•éªŒè¯

---

### 2. setuptools (è·¯å¾„éå†,RCEé£é™©) ğŸ”´

**å½“å‰ç‰ˆæœ¬**: 72.1.0
**ç›®æ ‡ç‰ˆæœ¬**: 78.1.1

**æ¼æ´è¯¦æƒ…**:
- **PYSEC-2025-49**: PackageIndexè·¯å¾„éå†å¯å¯¼è‡´ä»»æ„æ–‡ä»¶å†™å…¥,æ½œåœ¨RCE

**ä¿®å¤å‘½ä»¤**:
```bash
pip install --upgrade 'setuptools>=78.1.1'
```

**éªŒè¯**:
```bash
python3 -c "import setuptools; print(f'setuptools version: {setuptools.__version__}')"
# åº”è¾“å‡º: setuptools version: 78.1.1 (æˆ–æ›´é«˜)
```

**å…¼å®¹æ€§**:
- âœ… setuptools 78.1.1 å®Œå…¨å‘åå…¼å®¹
- â„¹ï¸ ä»…æ„å»ºæ—¶ä¾èµ–,ä¸å½±å“è¿è¡Œæ—¶

---

### 3. requests (.netrcå‡­è¯æ³„æ¼) ğŸŸ¡

**å½“å‰ç‰ˆæœ¬**: 2.32.3
**ç›®æ ‡ç‰ˆæœ¬**: 2.32.4

**æ¼æ´è¯¦æƒ…**:
- **CVE-2024-47081**: ç‰¹å®šæ¶æ„URLå¯èƒ½å¯¼è‡´.netrcå‡­è¯æ³„æ¼ç»™ç¬¬ä¸‰æ–¹

**ä¿®å¤å‘½ä»¤**:
```bash
pip install --upgrade 'requests>=2.32.4,<3.0.0'
```

**éªŒè¯**:
```bash
python3 -c "import requests; print(f'requests version: {requests.__version__}')"
# åº”è¾“å‡º: requests version: 2.32.4 (æˆ–æ›´é«˜)
```

**å…¼å®¹æ€§**:
- âœ… requests 2.32.4 å®Œå…¨å‘åå…¼å®¹2.32.3
- â„¹ï¸ å°ç‰ˆæœ¬æ›´æ–°,æ— APIå˜æ›´

---

### 4. werkzeug (Windowsè®¾å¤‡åDoS) ğŸŸ¡

**å½“å‰ç‰ˆæœ¬**: 3.1.3
**ç›®æ ‡ç‰ˆæœ¬**: 3.1.5

**æ¼æ´è¯¦æƒ…**:
- **CVE-2025-66221**: Windowsç‰¹æ®Šè®¾å¤‡å (CON/AUX) å¯¼è‡´æ–‡ä»¶è¯»å–æŒ‚èµ·
- **CVE-2026-21860**: è®¾å¤‡å+æ‰©å±•å (CON.txt) ä»å¯è§¦å‘

**ä¿®å¤å‘½ä»¤**:
```bash
pip install --upgrade 'werkzeug>=3.1.5,<4.0.0'
```

**éªŒè¯**:
```bash
python3 -c "import werkzeug; print(f'werkzeug version: {werkzeug.__version__}')"
# åº”è¾“å‡º: werkzeug version: 3.1.5 (æˆ–æ›´é«˜)
```

**å…¼å®¹æ€§**:
- âœ… werkzeug 3.1.5 å‘åå…¼å®¹3.1.x
- â„¹ï¸ ä»…å½±å“ `safe_join` å‡½æ•°,Lark Serviceæœªç›´æ¥ä½¿ç”¨

---

### 5. pynacl (libsodiumè¾¹ç¼˜æ¡ˆä¾‹) ğŸŸ¢

**å½“å‰ç‰ˆæœ¬**: 1.5.0
**ç›®æ ‡ç‰ˆæœ¬**: 1.6.2

**æ¼æ´è¯¦æƒ…**:
- **CVE-2025-69277**: libsodiumåœ¨éå…¸å‹åœºæ™¯ä¸‹æ¤­åœ†æ›²çº¿ç‚¹éªŒè¯é”™è¯¯

**ä¿®å¤å‘½ä»¤**:
```bash
pip install --upgrade 'pynacl>=1.6.2'
```

**éªŒè¯**:
```bash
python3 -c "import nacl; print(f'pynacl version: {nacl.__version__}')"
```

**å…¼å®¹æ€§**:
- âœ… pynacl 1.6.2 å‘åå…¼å®¹1.5.0
- â„¹ï¸ Lark Serviceä½¿ç”¨cryptographyè€Œépynacl,é—´æ¥ä¾èµ–

---

### 6. scrapy (å¤§æ–‡ä»¶DoS) ğŸŸ¡

**å½“å‰ç‰ˆæœ¬**: 2.12.0
**ä¿®å¤ç‰ˆæœ¬**: æ— å®˜æ–¹ä¿®å¤ç‰ˆæœ¬

**æ¼æ´è¯¦æƒ…**:
- **PYSEC-2017-83**: 2017å¹´æ—§æ¼æ´,å¤§æ–‡ä»¶å¯å¯¼è‡´å†…å­˜è€—å°½

**å»ºè®®**:
- â„¹ï¸ Lark Service **ä¸ç›´æ¥ä½¿ç”¨** scrapy
- â„¹ï¸ å¯èƒ½ä¸ºå¼€å‘ç¯å¢ƒæµ‹è¯•å·¥å…·çš„é—´æ¥ä¾èµ–
- â„¹ï¸ å»ºè®®ç§»é™¤æˆ–æ·»åŠ åˆ° `dev` ä¾èµ–ç»„

**å¤„ç†æ–¹å¼**:
```bash
# æ£€æŸ¥ scrapy æ˜¯å¦ä¸ºå¿…éœ€ä¾èµ–
pip show scrapy | grep "Required-by"

# å¦‚æœæ— å¿…éœ€ä¾èµ–,å¯å®‰å…¨ç§»é™¤
pip uninstall scrapy
```

---

## âœ… éªŒè¯æ¸…å•

ä¿®å¤å®Œæˆå,æ‰§è¡Œä»¥ä¸‹éªŒè¯:

### 1. ä¾èµ–ç‰ˆæœ¬æ£€æŸ¥

```bash
# æ£€æŸ¥å…³é”®åŒ…ç‰ˆæœ¬
python3 -c "
import urllib3
import setuptools
import requests
import werkzeug
import nacl

print(f'urllib3: {urllib3.__version__} (ç›®æ ‡â‰¥2.6.3)')
print(f'setuptools: {setuptools.__version__} (ç›®æ ‡â‰¥78.1.1)')
print(f'requests: {requests.__version__} (ç›®æ ‡â‰¥2.32.4)')
print(f'werkzeug: {werkzeug.__version__} (ç›®æ ‡â‰¥3.1.5)')
print(f'pynacl: {nacl.__version__} (ç›®æ ‡â‰¥1.6.2)')
"
```

**é¢„æœŸè¾“å‡º**:
```
urllib3: 2.6.3 (ç›®æ ‡â‰¥2.6.3) âœ…
setuptools: 78.1.1 (ç›®æ ‡â‰¥78.1.1) âœ…
requests: 2.32.4 (ç›®æ ‡â‰¥2.32.4) âœ…
werkzeug: 3.1.5 (ç›®æ ‡â‰¥3.1.5) âœ…
pynacl: 1.6.2 (ç›®æ ‡â‰¥1.6.2) âœ…
```

---

### 2. å•å…ƒæµ‹è¯•éªŒè¯

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
pytest tests/unit -v

# é¢„æœŸç»“æœ: 261 passed, 29 skipped
```

---

### 3. é‡æ–°æ‰«ææ¼æ´

```bash
# ä½¿ç”¨ pip-audit é‡æ–°æ‰«æ
pip-audit --desc

# é¢„æœŸç»“æœ: 0 vulnerabilities found (æˆ–ä»…å‰©scrapy)
```

---

### 4. é›†æˆæµ‹è¯• (å¯é€‰)

```bash
# è¿è¡Œé›†æˆæµ‹è¯• (éœ€è¦å®Œæ•´ç¯å¢ƒ)
pytest tests/integration -v

# éªŒè¯å…³é”®åŠŸèƒ½:
# - Tokenç®¡ç†æ­£å¸¸
# - APIè°ƒç”¨æ­£å¸¸
# - æ•°æ®åº“è¿æ¥æ­£å¸¸
```

---

## ğŸ“ æäº¤å˜æ›´

ä¿®å¤å®Œæˆå¹¶é€šè¿‡éªŒè¯å,æäº¤å˜æ›´:

```bash
# 1. æŸ¥çœ‹å˜æ›´
git diff requirements.txt

# 2. æš‚å­˜å˜æ›´
git add requirements.txt

# 3. æäº¤
git commit -m "fix: ä¿®å¤ä¾èµ–åŒ…å®‰å…¨æ¼æ´

## ä¿®å¤æ¼æ´æ¸…å•

é«˜å±æ¼æ´ (6ä¸ª):
- urllib3: 2.3.0 â†’ 2.6.3 (ä¿®å¤5ä¸ªCVE)
- setuptools: 72.1.0 â†’ 78.1.1 (è·¯å¾„éå†)

ä¸­å±æ¼æ´ (4ä¸ª):
- requests: 2.32.3 â†’ 2.32.4 (.netrcæ³„æ¼)
- werkzeug: 3.1.3 â†’ 3.1.5 (Windowsè®¾å¤‡å)

ä½å±æ¼æ´ (1ä¸ª):
- pynacl: 1.5.0 â†’ 1.6.2 (libsodium)

## éªŒè¯ç»“æœ

- âœ… å•å…ƒæµ‹è¯•: 261 passed
- âœ… ä¾èµ–æ‰«æ: 0 high/critical vulnerabilities
- âœ… å…¼å®¹æ€§: æ‰€æœ‰æµ‹è¯•é€šè¿‡

Refs: #Security, #Dependencies"

# 4. æ¨é€åˆ°è¿œç¨‹ (å¯é€‰)
# git push origin 001-lark-service-core
```

---

## â±ï¸ æ—¶é—´ä¼°ç®—

| æ­¥éª¤ | é¢„è®¡è€—æ—¶ | è¯´æ˜ |
|------|----------|------|
| **ä¾èµ–æ›´æ–°** | 10åˆ†é’Ÿ | pip install --upgrade |
| **å•å…ƒæµ‹è¯•** | 15åˆ†é’Ÿ | pytest tests/unit |
| **é›†æˆæµ‹è¯•** | 30åˆ†é’Ÿ | pytest tests/integration (å¯é€‰) |
| **æ¼æ´é‡æ‰«** | 5åˆ†é’Ÿ | pip-audit |
| **æ–‡æ¡£æ›´æ–°** | 10åˆ†é’Ÿ | æ›´æ–°CHANGELOG.md |
| **æäº¤å˜æ›´** | 5åˆ†é’Ÿ | git commit + push |
| **åº”æ€¥å›æ»š** | 15åˆ†é’Ÿ | é¢„ç•™æ—¶é—´ |
| **æ€»è®¡** | **1.5-2å°æ—¶** | - |

---

## ğŸš¨ é£é™©ä¸åº”æ€¥æ–¹æ¡ˆ

### æ½œåœ¨é£é™©

1. **ä¾èµ–å†²çª**: æ–°ç‰ˆæœ¬å¯èƒ½ä¸å…¶ä»–åŒ…å†²çª
2. **APIå˜æ›´**: urllib3 2.6.x å¯èƒ½æœ‰minor APIå˜æ›´
3. **æµ‹è¯•å¤±è´¥**: æ›´æ–°åéƒ¨åˆ†æµ‹è¯•å¯èƒ½å¤±è´¥

### åº”æ€¥å›æ»š

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜,å¯å¿«é€Ÿå›æ»š:

```bash
# 1. æŸ¥çœ‹ä¸Šä¸€æ¬¡æäº¤
git log --oneline -5

# 2. å›æ»šåˆ°ä¿®å¤å‰çš„ç‰ˆæœ¬
git checkout HEAD~1 requirements.txt

# 3. é‡æ–°å®‰è£…æ—§ç‰ˆæœ¬ä¾èµ–
pip install -r requirements.txt

# 4. éªŒè¯å›æ»šæˆåŠŸ
pytest tests/unit -v
```

---

## ğŸ“ åç»­æ”¯æŒ

ä¿®å¤å®Œæˆå,è¯·æ›´æ–°ä»¥ä¸‹æ–‡æ¡£:

1. **CHANGELOG.md**: è®°å½•ä¾èµ–æ›´æ–°
2. **docs/security-guide.md**: æ›´æ–°ä¾èµ–æ‰«æé¢‘ç‡
3. **FINAL-SUMMARY.md**: æ›´æ–°ç”Ÿäº§å°±ç»ªåº¦è¯„åˆ†

---

## ğŸ¯ æ‰§è¡Œå»ºè®®

**æ¨èæ–¹æ¡ˆ**: **ç­–ç•¥A (ç«‹å³ä¿®å¤æ‰€æœ‰é«˜å±æ¼æ´)**

**ç†ç”±**:
- âœ… ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰å·²çŸ¥æ¼æ´
- âœ… é™ä½å®‰å…¨é£é™©
- âœ… ç¬¦åˆFR-102è¦æ±‚ (æ¯æœˆæ£€æŸ¥ä¾èµ–æ›´æ–°)
- âœ… æå‡ç”Ÿäº§å°±ç»ªåº¦è¯„åˆ† (88 â†’ 95+)

**æ‰§è¡Œæ—¶é—´**: å»ºè®®åœ¨**ä»Šå¤©æˆ–æ˜å¤©**å®Œæˆ,ä¸è¶…è¿‡2å°æ—¶ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2026-01-18
**ç»´æŠ¤äºº**: AI Assistant
